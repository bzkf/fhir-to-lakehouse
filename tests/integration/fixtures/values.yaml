stream-processors:
  enabled: false
  strimziClusterName: fhir-to-delta-kafka
  securityContext:
    allowPrivilegeEscalation: false
    privileged: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
    runAsNonRoot: true
    runAsUser: 185
    runAsGroup: 185
    seccompProfile:
      type: RuntimeDefault
  processors:
    fhir-to-delta:
      replicaCount: 1
      kafka:
        topics:
          - fhir.msg
      container:
        image:
          registry: ghcr.io
          repository: bzkf/fhir-to-lakehouse
          tag: "" # set in CI
          pullPolicy: IfNotPresent
        envDict:
          SPARK_S3_ENDPOINT: fixtures-minio:9000
          KAFKA_CHECKPOINT_DIR: s3a://spark-streaming-checkpoints/fhir-to-delta
          DELTA_DATABASE_DIR: "s3a://fhir/warehouse"
        env:
          - name: "AWS_ACCESS_KEY_ID"
            valueFrom:
              secretKeyRef:
                name: "fixtures-minio"
                key: "root-user"
          - name: "AWS_SECRET_ACCESS_KEY"
            valueFrom:
              secretKeyRef:
                name: "fixtures-minio"
                key: "root-password"
        extraVolumeMounts:
          - name: spark-conf
            mountPath: /opt/spark/conf
            readOnly: true
      extraVolumes:
        - name: spark-conf
          configMap:
            name: "fixtures-spark-defaults-conf"

minio:
  defaultBuckets: "spark-streaming-checkpoints,fhir"
  auth:
    rootUser: "admin"
    rootPassword: "miniopass"
  service:
    type: NodePort
    nodePorts:
      api: "30900"
